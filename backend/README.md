# RAG Chatbot Backend API

This is the backend API for the Retrieval-Augmented Generation (RAG) chatbot for the humanoid robots book.

## Features

- FastAPI-based REST API
- Qwen-Embedding model for semantic search
- Qdrant Cloud for vector storage
- OpenRouter API for response generation
- Neon Serverless PostgreSQL for metadata storage
- Rate limiting and comprehensive error handling
- Streaming responses support

## Endpoints

### `/chat` (POST)
Generate RAG-powered responses to user queries.

Request body:
```json
{
  "query": "What are the key principles of humanoid robotics?",
  "selected_text": "Humanoid robots are designed to mimic human form and behavior...",
  "mode": "normal",
  "stream": false
}
```

Response:
```json
{
  "response": "The key principles of humanoid robotics include...",
  "citations": [
    {
      "source": "docs/introduction.md",
      "content": "Humanoid robots are designed to mimic human form and behavior...",
      "similarity_score": 0.85
    }
  ],
  "session_id": "session-12345",
  "tokens_used": 150
}
```

### `/index` (POST)
Process and embed Docusaurus content.

Request body:
```json
{
  "content_directory": "/path/to/docs",
  "chunk_size": 1000,
  "overlap": 100
}
```

Response:
```json
{
  "status": "success",
  "processed_files": 25,
  "indexed_chunks": 150,
  "message": "Successfully processed 25 files into 150 chunks"
}
```

### `/docs` and `/redoc`
Interactive API documentation automatically generated by FastAPI.

## Setup

1. Install dependencies:
   ```bash
   pip install -r requirements.txt
   ```

2. Set up environment variables in `.env`:
   ```bash
   OPENROUTER_API_KEY=your_openrouter_api_key
   QDRANT_API_KEY=your_qdrant_api_key
   QDRANT_URL=your_qdrant_cluster_url
   NEON_DB_URL=your_neon_db_connection_string
   QWEN_EMBEDDING_API_KEY=your_qwen_embedding_api_key
   ```

3. Run the application:
   ```bash
   uvicorn src.api.main:app --reload --port 8000
   ```

## Rate Limiting

- Chat endpoint: 10 requests per minute per IP
- Index endpoint: 5 requests per hour per IP
- Health check: 1000 requests per minute per IP

## Logging

The application logs important events and errors. Set the `LOG_LEVEL` environment variable to control the logging level (default is INFO).

## Testing

Run the application and visit `http://localhost:8000/docs` for interactive API documentation and testing.